<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<title>
  
    Archive: 2012
  
</title>

<meta property="og:type" content="website">
<meta property="og:title" content="Kevin's Blog">
<meta property="og:url" content="http://yoursite.com/archives/2012/page/2/index.html">
<meta property="og:site_name" content="Kevin's Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kevin's Blog">


  <link rel="alternative" href="/atom.xml" title="Kevin&#39;s Blog" type="application/atom+xml">



  <link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="/perfect-scrollbar/css/perfect-scrollbar.min.css">
<link rel="stylesheet" href="/styles/main.css">






</head>
<body
  
    class="monochrome"
  
  >
  <div class="mobile-header">
  <button class="sidebar-toggle" type="button">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="title" href="/">Kevin&#39;s Blog</a>
</div>

  <div class="main-container">
    <div class="sidebar">
  <div class="header">
    <h1 class="title"><a href="/">Kevin&#39;s Blog</a></h1>
    
    <div class="info">
      <div class="content">
        
        
          <div class="author">Hao Xi</div>
        
      </div>
      
        <div class="avatar">
          
            <a href="/about"><img src="https://cn.gravatar.com/avatar/35fef74d731255cd569c2c2b0b9e87e4?s=200"></a>
          
        </div>
      
    </div>
  </div>
  <div class="body">
    
      
        <ul class="nav">
          
            
              <li class="category-list-container">
                <a href="javascript:;">Category</a>
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithms/">Algorithms</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Asp-Net/">Asp.Net</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Basic-Theory/">Basic Theory</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Default/">Default</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/GNU-Linux/">GNU/Linux</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Interview/">Interview</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kevin-s-Life/">Kevin's Life</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Performance/">Performance</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Phone/">Phone</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Programming/">Programming</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Rework/">Rework</a><span class="category-list-count">1</span></li></ul>
              </li>
            
          
            
              <li class="tag-list-container">
                <a href="javascript:;">Tag</a>
                <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/2011-Plan/">2011 Plan</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ACM-ICPC/">ACM-ICPC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ActiveX/">ActiveX</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AfterLogic/">AfterLogic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithms/">Algorithms</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Asp-Net/">Asp.Net</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BFS/">BFS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Business/">Business</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C#</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CLRS/">CLRS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Concurrent/">Concurrent</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Coverage/">Coverage</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Critical-Section/">Critical Section</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DFS/">DFS</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-Structure/">Data Structure</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Design-Pattern-Series/">Design Pattern Series</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dovecot/">Dovecot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Download-Website/">Download Website</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dream/">Dream</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Email/">Email</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Environment-Variables/">Environment Variables</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/First-Post/">First Post</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Freelance/">Freelance</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GNOME/">GNOME</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Generic/">Generic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Happiness/">Happiness</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Heap/">Heap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/If-You-Are-The-One/">If You Are The One</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Interview/">Interview</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JobFinder/">JobFinder</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Josephus/">Josephus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KDE/">KDE</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KMP/">KMP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Let-The-Bullet-Fly/">Let The Bullet Fly</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MSMQ/">MSMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac/">Mac</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Management/">Management</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Memory/">Memory</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Monte-Carlo/">Monte Carlo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Movies/">Movies</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mutex/">Mutex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/My-Blogs/">My Blogs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/My-Life/">My Life</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/My-Name/">My Name</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ncover/">Ncover</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nunit/">Nunit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Old-Boys/">Old Boys</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Online-Judge/">Online Judge</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenMP/">OpenMP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Parallel-Programming/">Parallel Programming</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Postfix/">Postfix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Present/">Present</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Primer/">Primer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Queue/">Queue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reading/">Reading</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Recursion/">Recursion</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reverse-Polish-Notation/">Reverse Polish Notation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rework/">Rework</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ShengYiJie/">ShengYiJie</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Silverlight/">Silverlight</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Singleton/">Singleton</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sparse-Matrix/">Sparse Matrix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Stack/">Stack</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Stirling-s-Formula/">Stirling's Formula</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/String-Matching/">String Matching</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Template/">Template</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Teru-Teru-Bouz/">Teru Teru Bouz</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/The-bright-eleven/">The bright eleven</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Theory/">Theory</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thread/">Thread</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Trace/">Trace</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Translation/">Translation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Triple-Table/">Triple Table</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unit-Test/">Unit Test</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VPS/">VPS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webmail/">Webmail</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wedding/">Wedding</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/">Windows</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows-Phone-7/">Windows Phone 7</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/X-Window/">X Window</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xml/">Xml</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iPhone/">iPhone</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vWorker/">vWorker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wget/">wget</a><span class="tag-list-count">1</span></li></ul>
              </li>
            
          
            
              <li class="archive-list-container">
                <a href="javascript:;">Archive</a>
                <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/">2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/">2012</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/">2011</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/">2010</a><span class="archive-list-count">25</span></li></ul>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="/" title="Homepage">Homepage</a>
              </li>
            
          
            
              <li>
                <a href="/archives" title="By Year">By Year</a>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="https://github.com/denjones/hexo-theme-chan" title="Chan" target="_blank" rel="external">Chan</a>
              </li>
            
          
            
              <li>
                <a href="https://github.com/denjones" title="Github" target="_blank" rel="external">Github</a>
              </li>
            
          
            
              <li>
                <a href="/atom.xml" title="RSS">RSS</a>
              </li>
            
          
        </ul>
      
    
  </div>
</div>

    <div class="main-content">
      
        <div style="max-width: 1000px">
      
          

  
  
    
      
      
      <section class="archives-wrap">
        <div class="archive-year-wrap">
          <h1><a href="/archives/2012" class="archive-year">2012</a></h1>
        </div>
        <div class="post-list">
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2012/03/06/263/" >
  263
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2012/03/06/263/"><span class="article-date">
  2012-03-06
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Default/">Default</a></li></ul>
	</span>


        

      </div>
      <div class="article-entry">
        
          <p>Track from JetCracker’s blog, my 1st Reblog:) really nice explanation on the value of programming: turns thoughts into reality.</p>

        
      </div>
    </div>

  

  
  
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2012/03/04/warm-up-series-4-memory-allocation-in-csharp/" >
  Warm Up Series (4) – Memory Allocation in CSharp
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2012/03/04/warm-up-series-4-memory-allocation-in-csharp/"><span class="article-date">
  2012-03-04
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Programming/">Programming</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Programming/Warm-Up/">Warm Up</a></li></ul></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C#</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p>在写完上一篇文章后，开始联想到.NET的内存管理机制，于是继续Google出一些文章，大概对C#中的内存管理有了了解。C#的内存管理的实现是在操作系统内存管理之上的，特别是托管堆的3 generations的设计，既保护了代码编写的方便性，也充分考虑了性能的优化。</p>
<p>按照MSDN文档介绍，除stackalloc运算符外，C#不提供其他任何方法来操作非托管的内存。所以这些服务通常只能由基础操作系统导入。<a href="http://msdn.microsoft.com/zh-cn/library/aa664786(v=vs.71" target="_blank" rel="external">这里的例子</a>.aspx)通过非安全代码调用系统API实现了托管堆以外的内存管理。</p>
<p>&#160;</p>
<p>转自《<a href="http://www.cnblogs.com/yangjunwl/archive/2008/01/08/1029903.html" target="_blank" rel="external">C#的内存管理：堆栈、托管堆与指针</a>》</p>
<p>在32位的Windows操作系统中，每个进程都可以使用4GB的内存，这得益于虚拟寻址技术，在C#中，虚拟内存有个两个存储变量的区域，堆栈和托管堆；堆栈存储值类型数据，每个线程都有自己的堆栈。而托管堆存储引用类型如类、对象，并受垃圾收集器的管理。当一个类对象不再被使用时，这个对象被存储在堆栈中的引用变量将被删除，但是在托管堆中的对象实例仍然存在，其空间何时被释放取决垃圾收集器。</p>
<p>在C/C++中，程序运行久了可能会产生大量的内存碎片，寻址这些碎片数据也会增加系统开销。在.NET中这种情况得到很大改善，因为垃圾收集器会压缩托管堆的内存空间，保证可用变量在一个连续的内存空间内，同时将堆栈中引用变量中的地址更新为新的地址，虽然这会带来额外的系统开销，但是，其降低了内存碎片程度和内存泄露问题。</p>
<p>另一方面，在某些时候C#程序也需要追求速度，比如对一个含用大量成员的数组操作，因为数组在C#中是System.Array的实例，会存储在托管堆中，这将会对运算造成大量的额外的操作，因为除了垃圾收集器除了会压缩托管堆、更新引用地址、还会维护托管堆的信息列表。所幸的是C#中同样能够通过使用标记为unsafe的代码块调用指针，比如声明一个存储有50个double类型的数组：</p>
<font face="Courier New"><span class="kwrd">double</span> *pDouble = <span class="kwrd">stackalloc</span> <span class="kwrd">double</span>[50];</font>

<p>垃圾收集器和堆管理系统常常涉及为提高性能而作的优化设计。举例来说，垃圾收集遍历整个内存池具有很高的开销。然而，研究表明大部分在托管堆上分配的对象只有很短的生存期，因此堆被分成三个段，称作generations。新分配的对象被放在generation 0中。这个generation是最先被回收的，在这个generation中最有可能找到不再使用的内存，由于它的尺寸很小（小到足以放进处理器的L2 cache中），因此它里面的回收将是最高效的。托管堆的另外一种优化操作与locality of reference规则有关。该规则表明，一起分配的对象经常被一起使用。如果对象们在堆中位置很紧凑的话，高速缓存的性能将会得到提高。由于托管堆的天性，对象们总是被分配在连续的地址上，使得对象们始终彼此靠近。这一点与非托管代码形成了鲜明的对比，在标准堆中，堆很容易变成碎片，而且一起分配的对象经常分得很远。还有一种优化与大对象有关，大对象堆用来放置尺寸超过85K的对象，这部分数据一般不会被GC，但当generation 2发生垃圾会收时，意味着系统可能无法分配所需的内存，这时大对象堆上也需要进行垃圾回收。</p>
<p>再说内存分配，当对象被分配的时候，它们一开始被放在generation 0中。当generation 0的大小快要达到它的上限的时候，一个只在generation 0中执行的回收操作被触发。由于其大小很小，因此这将是一个非常快的过程，其不再使用的对象将被释放，正被使用的对象被整理并移入generation 1中。当generation 1的大小随着从generation 0中移入的对象数量的增加而接近上限时，一个回收动作将会在generation 0和generation 1中执行，不再使用的对象被释放，正在被使用的对象被整理并移入下一个generation中。大部分GC过程的主要目标是generation 0，因为在generation 0中最有可能存在大量的已不再使用的临时对象。对generation 2的回收过程具有很高的开销，此过程只有在generation 0和generation 1的GC过程不能释放足够的内存时才会被触发。如果对generation 2的GC过程仍然不能释放足够的内存，那么系统就会抛出OutOfMemoryException异常。</p>
<p>当然，C#程序中也存在值类型和托管堆不能管理的对象，比如文件名柄、网络连接和数据库连接，这些变量的释放仍需要程序员通过析构函数或IDispose接口来做。对于所有拥有外部资源的类，在这些资源已经不再用到的时候，都应当执行Close或者Dispose方法。Dispose模式通过IDisposable接口来实现，需要清理外部资源的类还应当实现一个终止操作。在C#中，创建终止操作的首选方式是在析构函数中实现，而在Framework层，终止操作的实现则是通过重载System.Object.Finalize 方法。</p>
<p>带有终止操作的对象的垃圾收集过程要稍微复杂一些。当一个带有终止操作的对象被标记为垃圾时，它并不会被立即释放。相反，它会被放置在一个终止队列中，此队列为这个对象建立一个引用，来避免这个对象被回收。后台线程为队列中的每个对象执行它们各自的终止操作，并且将已经执行过终止操作的对象从终止队列中删除。只有那些已经执行过终止操作的对象才会在下一次垃圾回收过程中被从内存中删除。</p>
<p>&#160;</p>
<p>转自《<a href="http://blog.csdn.net/songkexin/article/details/5376389" target="_blank" rel="external">.NET内存分配浅析</a>》</p>
<p>这篇文章中阐述的内容大多和上一篇类似，而且文本比较差，故只摘录一小部分：</p>
<p>托管堆被触发GC的三个可能条件：</p>
<ul>
<li>1、当在托管堆上的generation 0分配内存被耗尽时（最常见），或者分配一个大对象超过了大对象堆的阀值。<em>   2、当显示调用GC.Collect()的时候。</em>   3、当操作系统的内存比较紧张时，这时操作系统会通知垃圾收集器进行GC。  </li>
</ul>
<p>&#160;</p>
<p>转自《<a href="http://www.cnblogs.com/instance/archive/2011/05/24/2056091.html" target="_blank" rel="external">原来是这样：C#中字符串的内存分配与驻留池</a>》</p>
<p>这篇文章主要是对.NET中CLR对String类内存管理上的优化处理进行分析：</p>
<p>CLR维护一个叫做驻留池（Intern Pool）的表。这个表记录了所有在代码中使用字面量声明的字符串实例的引用。使用字面量声明的字符串会进入驻留池，而其他方式声明的字符串则不会进入，也就不会自动享受到CLR防止字符串冗余的机制的好处了。请看这个例子：</p>
<font face="Courier New">StringBuilder sb = new StringBuilder();<br>sb.Append(&quot;He&quot;).Append(&quot;llo&quot;);<br>string s1 = &quot;Hello&quot;;<br>string s2 = sb.ToString();<br>bool same = (object) s1 == (object) s2;</font>

<p>这时由于s2不是通过字面量声明的，CLR在为sb.ToString()方法的返回值分配内存时，并不会到驻留池中检查是否有值为“Hello”的字符串已经存在，所以不会让s2指向驻留池内的对象。为了让编程者能够强制CLR检查驻留池，以避免冗余的字符串副本，String类的设计者提供了一个名为Intern的类方法。下面是该方法的一个示例：</p>
<font face="Courier New">StringBuilder sb = new StringBuilder();<br>sb.Append(&quot;He&quot;).Append(&quot;llo&quot;);<br>string s1 = &quot;Hello&quot;;<br>string s2 = String.Intern(sb.ToString());<br>bool same = (object) s1 == (object) s2;</font>

<p>好了，same又是true了。Intern方法接受一个字符串作为参数，它会在驻留池中检查是否存在参数所表示的字符串。如果存在，则返回那个驻留池中的字符串的引用；否则向驻留池中加入一个新的表示相同值的字符串，并返回这个字符串的引用。不过要注意的是，就算Intern方法在驻留池中找到了相同值的字符串，也不能让您省却一次字符串内存分配的操作，因为作为参数的字符串已经被分配了一次内存了。而使用Intern方法的好处在于，如果Intern方法在驻留池中找到了相同值的字符串，此时虽然在内存中存在两份该字符串的副本（一份是参数，一份是驻留池中的），但是随着时间的流逝，参数所引用的那个副本会被垃圾回收掉，这样对于该字符串内存中就不存在冗余了。</p>
<p>当您的程序中存在某个方法，可以根据不同的上下文环境创建并返回一个很长的字符串，而在程序运行的过程中它有会经常返回同样的字符串时，您可能就要考虑考虑使用Intern方法来提高内存的利用率了。不过同样值得注意的是，使用Intern方法让一个字符串存活于驻留池中也有一个副作用：即使已经不存在任何其它引用指向驻留池中的字符串了，这个字符串仍然不一定会被垃圾回收掉。也就是说即使驻留池中的字符串已经没有用处了，它可能也要等到CLR终结时才被销毁。当您使用Intern方法的时候，也应该考虑到这个特殊的行为。</p>

        
      </div>
    </div>

  

  
  
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2012/03/04/warm-up-series-3-dynamic-memory-allocation/" >
  Warm Up Series (3) – Dynamic Memory Allocation
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2012/03/04/warm-up-series-3-dynamic-memory-allocation/"><span class="article-date">
  2012-03-04
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Programming/">Programming</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Programming/Warm-Up/">Warm Up</a></li></ul></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C#</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p>在摘抄完<a href="http://kevinxi.wordpress.com/2012/03/02/warm-up-series-2-process-memory-allocation/" target="_blank" rel="external">第二篇文章</a>后，我又在国外的<a href="http://www.cprogramming.com" target="_blank" rel="external">C编程网站</a>上看到了关于内存管理的系列文章，自认为比从国内论坛上东拼西凑出一套结论更有说服力，故摘抄和翻译部分内容如下：</p>
<p>&#160;</p>
<p>1. 高级内存管理（<a href="http://www.cprogramming.com/tutorial/dynamic_memory_allocation.html" target="_blank" rel="external"><font size="1">Advanced Memory Management</font></a> ）<br>在C++中不提倡使用void<em>指针，在使用多层继承时，基类中对不同子类对象看到的值可能是不一样的（多态，基类指针位置相同，但对象大小的偏移不同）。如果使用void</em>指针，则会破坏C++的多态性，这里应尽早使用dynamic_cast或者static_cast自动纠正指针指向的数据。</p>
<p>使用new[]将动态分配整数组的目标对象的内存，并调用该对象的默认构造函数，返回第一个对象的指针；使用new[]操作符时，只能够使用默认构造函数，无法调用带参数的构造函数。</p>
<p>&#160;</p>
<p>2. 动态内存分配和虚拟内存（<a href="http://www.cprogramming.com/tutorial/virtual_memory_and_heaps.html" target="_blank" rel="external"><font size="1">Dynamic Memory Allocation and Virtual Memory</font></a> ）</p>
<p>一般来说，每个进程的内存地址空间可以分为6个部分：环境区，用于保存环境变量和命令行参数；栈区，用于保存函数参数、返回值、内部变量等；堆区（自由存储区），用于动态分配内存；未初始化的静态或全局变量；初始化的静态或全局变量；代码区，加载代码的区域。</p>
<p><a href="http://kevinxi.files.wordpress.com/2012/03/image.png" target="_blank" rel="external"><img src="http://kevinxi.files.wordpress.com/2012/03/image_thumb.png" alt="image" title="image"></a></p>
<p>堆区实质上是一块连续的有碎片的内存区域。当程序请求动态内存时，系统从堆区剩余未分配的内存空间中，查找满足要求的连续内存块，并返回找到的内存区域的指针。对于堆区内存分配的算法，有的是遍历空余内存并找出最小的满足要求的内存块，有的是找出第一个满足要求的内存块。通常，系统会维护一个空闲内存的二叉数，方便快速的发现和合理分配内存。</p>
<p><a href="http://kevinxi.files.wordpress.com/2012/03/image1.png" target="_blank" rel="external"><img src="http://kevinxi.files.wordpress.com/2012/03/image_thumb1.png" alt="image" title="image"></a>    </p>
<p>3. 用new/delete自定义内存分配（<a href="http://www.cprogramming.com/tutorial/operator_new.html" target="_blank" rel="external"><font size="1">Customized Allocators with Operator New and Operator Delete</font></a> ）</p>
<p>假设你有一个链表，并且你希望提高节点内存分配的速度。那么一种可行的方法是维护一组已经被删除的节点，并且在需要添加新节点的时候重用它们的内存。在此前提下，我们可以重载new运算符，并且试图从删除的节点列表中找到可重用的节点，只有当删除的节点列表为空时，我们再真正的动态申请内存。而delete运算符则简单的将节点加入删除的节点列表中。</p>
<p>另一个重载new/delete运算符的应用是实现内存的垃圾回收，你可以实现一套类似与Java或者C#的内存回收器，这样，当你分配的内存不再被使用时，可以被自动的回收。</p>
<p>&#160;</p>
<p>4. C++常见内存管理问题（<a href="http://www.cprogramming.com/tutorial/c++_memory_problems.html" target="_blank" rel="external"><font size="1">Common Memory Management Problems in C++</font></a>）</p>
<p>这篇文章主要提供了一些检查内存泄露的工具，比如IBM的<a href="http://www-01.ibm.com/software/awdtools/purify/" target="_blank" rel="external">Purify</a>，以及建议使用自定义堆或者智能指针（标准库里面的auto_ptr）来防止内存泄露。</p>

        
      </div>
    </div>

  

  
  
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2012/03/02/warm-up-series-2-process-memory-allocation/" >
  Warm Up Series (2) – Process Memory Allocation
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2012/03/02/warm-up-series-2-process-memory-allocation/"><span class="article-date">
  2012-03-02
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Programming/">Programming</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Programming/Warm-Up/">Warm Up</a></li></ul></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C#</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p>C和C++编译器对内存分配的处理并不完全相同，但大致都可以分为两个部分：代码区和数据区；代码区是用来放置代码的，这部分内存在程序加载时就会被分配好；数据区根据网上很多说法，C和C++在这方面也只有很小的差别。</p>
<p>1. C程序数据区内存</p>
<p><strong>栈</strong> - 由编译器自动分配释放，存放为运行函数而分配的局部变量、函数参数、返回数据、返回地址等，其操作方式类似于数据结构中的栈。通过alloca方法可以在栈上手动的分配内存，栈的动态分配和堆是不同的，他的动态分配是由编译器进行释放，无需我们手工实现。不过此举并不被推荐，详见<a href="http://stackoverflow.com/questions/1018853/why-is-alloca-not-considered-good-practice" target="_blank" rel="external">此</a>文章。<br><strong>堆</strong> - 由程序分配释放，若程序不释放，在程序结束时操作系统一般会回收泄露的内存。一般是在堆的头部用一个字节存放堆的大小。堆中的具体内容有程序员安排。<br><strong>全局/静态区</strong> - 全局变量和静态变量的存储是在一块的，初始化的全局变量和静态变量在一块区域，未初始化的在相邻的一块区域，均在程序结束时释放。<br><strong>常量</strong> - 放置程序中的常量，程序结束时释放。</p>
<p>2. C++程序数据区内存</p>
<p><strong>栈 </strong>- 同上。<br><strong>堆 </strong>- 程序中由malloc和free来控制分配和回收的内存块，若程序不释放，在程序结束时由操作系统回收。<br><strong>自由存储区</strong> – 程序中由new和delete来控制分配和回收的内存块，若程序不释放，在程序结束时由操作系统回收。<br><strong>全局/静态区</strong> - 全局变量和静态变量被分配到同一块内存中，在以前的C语言中，全局变量又分为初始化的和未初始化的，在C++里面没有这个区分了，他们共同占用同一块内存区。<br><strong>常量 </strong>- 同上。</p>
<p>3. 自由存储区和堆区的区别</p>
<font color="#000000">以上内容从</font><a href="http://www.cppblog.com/zhaoyg/archive/2008/05/30/51587.html" target="_blank" rel="external"><font color="#000000">此</font></a><font color="#000000">文章整理而出，原文对C++中自由存储区和堆的介绍有错误，正确的介绍可以参考</font><a href="http://www.gotw.ca/gotw/009.htm" target="_blank" rel="external"><font color="#000000">英文原文</font></a><font color="#000000">，相关部分中文翻译如下：</font><br>  &gt; 自由存储区是C++两个动态内存区域之一，使用new和delete来予以分配和释放。在自由存储区中，对象的生存周期可以比存放它的内存区的生存周期短；也就是说，我们可以获得一片内存区而不用马上对其进行初始化；同时，在对象被销毁之后，也不用马上收回其占用的内存区。在对象被销毁而其占用的内存区还未被收回的这段时间内，我们可以通过void*的指针访问这片区域，但是其原始对象的非静态成员以及成员函数（即使我们知道了它们的地址）都不能被访问或者操纵。<br>&gt;<br>&gt; 堆区是另一个动态存储区域，使用malloc和free以及他们的变形体来进行分配和回收。要注意，虽然在特定的编译器里缺省的全局运算符new和delete也许会按照malloc和free的方式来被实现，但是堆与自由存储区是不同的——<font color="#666666">在某一个区域内被分配的内存不能在另一个区域内被安全的回收。</font>堆中被分配的内存一般用于对类对象进行placement-new的构造和explicit的析构。堆中对象的生存周期与自由存储区中的类似。<br><br><font color="#000000">C++中关于自由存储区和堆区的区别并不能统一而论，在写代码时，只要保证new-delete和malloc-free的对应关系，已经可以有效防止编译器实现差异造成的问题。</font>

<p>4. 堆区和栈区的主要区别 </p>
<p><strong>管理方式</strong>：对于栈来讲，是由编译器自动管理，无需我们手工控制；对于堆来说，释放工作由程序员控制，操作不当会产生内存泄露。 </p>
<p><strong>空间大小</strong>：一般来讲在32位系统下，堆内存可以达到4G的空间，从这个角度来看堆内存几乎是没有什么限制的。但是对于栈来讲，一般都是有一定的空间大小的，在WINDOWS下，栈的大小是2M（VC6下默认的栈空间大小是1M，总之是一个编译时就确定的常数），如果申请的空间超过栈的剩余空间，将提示栈溢出。因此，能从栈获得的空间较小。当然，这个值可以修改。 </p>
<p><strong>碎片问题</strong>：对于堆来讲，频繁的new/delete势必会造成内存空间的不连续，从而造成大量的碎片，使程序效率降低。对于栈来讲，则不会存在这个问题，因为栈是先进后出的队列。 </p>
<p><strong>生长方向</strong>：对于堆来讲，生长方向是向上的，也就是向着内存地址增加的方向；对于栈来讲，它的生长方向是向下的，是向着内存地址减小的方向增长。 </p>
<p><strong>分配方式</strong>：堆都是动态分配的，没有静态分配的堆。栈有2种分配方式：静态分配和动态分配。静态分配是编译器完成的，比如局部变量的分配。动态分配由alloca函数进行分配，但是栈的动态分配和堆是不同的，他的动态分配是由编译器进行释放，无需我们手工实现。 </p>
<p><strong>分配效率</strong>：栈是机器系统提供的数据结构，计算机会在底层对栈提供支持：分配专门的寄存器存放栈的地址，压栈出栈都有专门的指令执行，这就决定了栈的效率比较高。堆则是C/C++函数库提供的，它的机制是很复杂的，例如为了分配一块内存，库函数会按照一定的算法在堆内存中搜索可用的足够大小的空间，如果没有足够大小的空间（可能是由于内存碎片太多），就有可能调用系统功能去增加程序数据段的内存空间，这样就有机会分到足够大小的内存，然后返回。显然，堆的效率比栈要低得多。</p>
<p>从这里我们可以看到，堆和栈相比，由于大量new/delete的使用，容易造成大量的内存碎片；由于没有专门的系统支持，效率很低；由于可能引发用户态和核心态的切换，内存的申请，代价变得更加昂贵。所以栈在程序中是应用最广泛的，就算是函数的调用也利用栈去完成，函数调用过程中的参数，返回地址，EBP和局部变量都采用栈的方式存放。</p>
<p>虽然栈有如此众多的好处，但是由于和堆相比不是那么灵活，有时候分配大量的内存空间，还是用堆好一些。另外，如果有人把堆栈合起来说，那它的意思是栈，可不是堆。</p>
<p>5. new/delete与malloc/free比较</p>
<p>从C++角度上说，使用new分配堆空间<font color="#ff0000">可以调用类的构造函数</font>，而malloc()函数仅仅是一个函数调用，它不会调用构造函数，它所接受的参数是一个unsigned long类型。同样，delete在释放堆空间之前<font color="#ff0000">会调用析构函数</font>，而free函数则不会。</p>
<p>从结果可以看出，使用new/delete可以调用对象的构造函数与析构函数，并且示例中调用的是一个非默认构造函数。在堆上分配对象数组时，只能调用默认构造函数，不能调用其他任何构造函数。</p>
<p>&#160;</p>
<font color="#ff0000">Update: 关于程序内存结构的说明众说纷纭，在看了国外权威网站的英文介绍后，我认为</font><a href="http://www.diybl.com/course/3_program/c++/cppjs/20110103/552239.html" target="_blank" rel="external"><font color="#ff0000">这一篇</font></a><font color="#ff0000">中文文章的解释与英文版比较接近，另外，也可以参考</font><a href="http://www.cprogramming.com/tutorial/virtual_memory_and_heaps.html" target="_blank" rel="external"><font color="#ff0000">这篇</font></a><font color="#ff0000">英文原文。</font>
        
      </div>
    </div>

  

  
  
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2012/03/02/warm-up-series-1-cc-compilation-procedure/" >
  Warm Up Series (1) – C/C++ Compilation Procedure
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2012/03/02/warm-up-series-1-cc-compilation-procedure/"><span class="article-date">
  2012-03-02
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Programming/">Programming</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Programming/Warm-Up/">Warm Up</a></li></ul></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C#</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p>转自：<a href="http://www.52rd.com/Blog/Detail_RD.Blog_hustsimoon_5196.html" target="_blank" rel="external">hustsimoon的专栏《源程序怎么变成可执行文件—初学C语言难免碰到的困惑》</a></p>
<p>&#160;</p>
<p>电子计算机所使用的是由“0”和“1”组成的二进制数，二进制是计算机的语言的基础。计算机发明之初，人们只能用计算机语言去命令计算机干这干那，写出一串串由“0”和“1”组成的指令序列交由计算机执行，这就是机器语言。</p>
<p>为了减轻使用机器语言编程的痛苦，人们进行了一种有益的改进：用一些简洁的英文字母、符号串来替代一些特定的指令的二进制串，比如，用“ADD”代表加法，“MOV”代表数据传递等，这样一来，人们很容易读懂并理解程序在干什么，纠错及维护都变得方便了，这种程序设计语言就称为汇编语言，即第二代计算机语言。然而计算机是不认识这些符号的，这就需要一个专门的程序，专门负责将这些符号翻译成二进制数的机器语言，这种翻译程序被称为汇编程序。<u>汇编指令和机器语言之间有着一一对应的关系</u>。</p>
<p>高级语言是偏向人，按照人的思维方式设计的，机器对这些可是莫名奇妙，不知所谓。于是必须要有一个桥梁来衔接两者。当你越想方便，那桥就得越复杂。那高级语言是如何变成机器语言的呢，这个过程让我慢慢道来。</p>
<p>编译：将源代码转换为机器可认识代码的过程。编译程序读取源程序（字符流），对之进行<u>词法和语法的分析</u>，<u>将高级语言指令转换为功能等效的汇编代码</u>，再由汇编程序转换为机器语言，并且按照操作系统对可执行文件格式的要求链接生成可执行程序。</p>
<font color="#ff0000">C源程序－&gt;编译预处理－&gt;编译－&gt;优化程序－&gt;汇编程序－&gt;链接程序－&gt;可执行文件</font>

<p>1. 编译预处理</p>
<p>伪指令主要包括以下四个方面</p>
<p>（1）宏定义指令，如 #define,#undef等。对于前一个伪指令，预编译所要作得的是字符串替换，注意其中字符串常量不会被替换。对于后者，则将取消对某个宏的定义，以后该串的出现将不再被替换。</p>
<p>（2）条件编译指令，如#ifdef,#ifndef,#else,#elif,#endif等等。这些伪指令的引入使得程序员可以通过定义不同的宏来决定编译程序对哪些代码进行处理。预编译程序将根据有关的文件，将那些不必要的代码过滤掉。</p>
<p>（3）头文件包含指令，如#include &quot;xxx&quot;或者#include &lt;xxx&gt;等。预编译程序将把头文件中的定义统统都加入到它所产生的输出文件中，以供编译程序对之进行处理。</p>
<p>（4）特殊符号，预编译程序可以识别一些特殊的符号。例如在源程序中出现的LINE标识将被解释为当前行号（十进制数），FILE则被解释为当前被编译的C源程序的名称。预编译程序对于在源程序中出现的这些串将用合适的值进行替换。</p>
<p>预编译程序所完成的基本上是对源程序的“替代”工作。经过此种替代，生成一个没有宏定义、条件编译指令、特殊符号的输出文件。这个文件的含义同没有经过预处理的源文件是相同的，但内容有所不同。下一步，此输出文件将作为编译程序的输入而被翻译成为机器指令。</p>
<p>2. 编译阶段</p>
<p>编译程序所要作得工作就是通过词法分析和语法分析，在确认所有的指令都符合语法规则之后，将其翻译成等价的中间代码表示或汇编代码。</p>
<p>3.优化阶段</p>
<p>优化处理是编译系统中一项比较艰深的技术。它涉及到的问题不仅同编译技术本身有关，而且同机器的硬件环境也有很大的关系。优化一部分是对中间代码的优化。这种优化不依赖于具体的计算机。另一种优化则主要针对目标代码的生成而进行的。</p>
<p>对于前一种优化，主要的工作是删除公共表达式、循环优化（代码外提、强度削弱、变换循环控制条件、已知量的合并等）、复写传播，以及无用赋值的删除，等等。</p>
<p>后一种类型的优化同机器的硬件结构密切相关，最主要的是考虑是如何充分利用机器的各个硬件寄存器存放的有关变量的值，以减少对于内存的访问次数。另外，根据机器硬件执行指令的特点（如流水线、RISC、CISC、VLIW等）而对指令进行一些调整使得目标代码较短，执行的效率较高。</p>
<p>4.汇编过程</p>
<p>汇编过程实际上指把汇编语言代码翻译成目标机器指令的过程。对于被翻译系统处理的每一个C语言源程序，都将最终经过这一处理而得到相应的目标文件。目标文件中所存放的也就是与源程序等效的目标的机器语言代码。</p>
<p>目标文件由段组成。通常一个目标文件中至少有两个段：</p>
<p>代码段 该段中所包含的主要是程序的指令。该段一般是可读和可执行的，但一般却不可写。</p>
<p>数据段 主要存放程序中要用到的各种全局变量或静态的数据。一般数据段都是可读，可写，可执行的。</p>
<p>5.链接程序</p>
<p>由汇编程序生成的目标文件并不能立即就被执行，其中可能还有许多没有解决的问题。例如，某个源文件中的函数可能引用了另一个源文件中定义的某个符号（如变量或者函数调用等）；在程序中可能调用了某个库文件中的函数，等等。所有的这些问题，都需要经链接程序的处理方能得以解决。</p>
<p>链接程序的主要工作就是将有关的目标文件彼此相连接，也即将在一个文件中引用的符号同该符号在另外一个文件中的定义连接起来，使得所有的这些目标文件成为一个能够被操作系统装入执行的统一整体。</p>
<p>根据开发人员指定的同库函数的链接方式的不同，链接处理可分为两种：</p>
<p>（1）静态链接 在这种链接方式下，函数的代码将从其所在地静态链接库中被拷贝到最终的可执行程序中。这样该程序在被执行时这些代码将被装入到该进程的虚拟地址空间中。静态链接库实际上是一个目标文件的集合，其中的每个文件含有库中的一个或者一组相关函数的代码。</p>
<p>（2）动态链接 在此种方式下，函数的代码被放到称作是动态链接库或共享对象的某个目标文件中。链接程序此时所作的只是在最终的可执行程序中记录下共享对象的名字以及其它少量的登记信息。在此可执行文件被执行时，动态链接库的全部内容将被映射到运行时相应进程的虚地址空间。动态链接程序将根据可执行程序中记录的信息找到相应的函数代码。</p>
<p>对于可执行文件中的函数调用，可分别采用动态链接或静态链接的方法。使用动态链接能够使最终的可执行文件比较短小，并且当共享对象被多个进程使用时能节约一些内存，因为在内存中只需要保存一份此共享对象的代码。但并不是使用动态链接就一定比使用静态链接要优越。在某些情况下动态链接可能带来一些性能上损害。</p>
<p>经过上述五个过程，C源程序就最终被转换成可执行文件了。</p>
<p>&#160;</p>
<font color="#ff0000">Update: C++语言中提供了模板功能，模板实例化的过程发生在上述第二阶段，编译阶段。</font>

<p>程序员在使用模板类时最常犯的错误是将模板类视为某种数据类型。模板不是数据类型，模板就是模板；编译器使用模板，通过更换模板参数来创建数据类型，这个过程就是模板实例化；从模板类创建得到的类型称之为特例；模板实例化取决于编译器能够找到可用代码来创建特例(称之为实例化要素)；要创建特例，编译器不但要看到模板的声明，还要看到模板的定义；<u>模板实例化过程是迟钝的，即只能用函数的定义来实现实例化</u>。</p>
<p>对于传统C/C++的开发人员，一个好的习惯是将类的定义写在.h文件中，将类的实现写在.cpp文件中，这种做法在实现C++模板类时，则可以会在链接阶段遇到问题。解决问题的简单方法是将模板类的实现写成内联的形式，或者显示的实例化需要的模板实例，详细可参考<a href="http://blog.csdn.net/look01/article/details/3228134" target="_blank" rel="external">这篇</a>文章。</p>

        
      </div>
    </div>

  

  
  
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2012/02/17/a-conclusion-on-managing-shengyijie-project/" >
  A conclusion on managing ShengYiJie project
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2012/02/17/a-conclusion-on-managing-shengyijie-project/"><span class="article-date">
  2012-02-17
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Kevin-s-Life/">Kevin's Life</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Kevin-s-Life/Phone/">Phone</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Kevin-s-Life/Phone/Programming/">Programming</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Kevin-s-Life/Phone/Programming/Rework/">Rework</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Kevin-s-Life/Phone/Programming/Rework/Summary/">Summary</a></li></ul></li></ul></li></ul></li></ul></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rework/">Rework</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ShengYiJie/">ShengYiJie</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iPhone/">iPhone</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p>本文主要对我在管理生意街手机项目过程中犯得一些错误进行记录，方便以后查阅，防止再犯同样的错误。</p>
<p>项目的成败，管理者要负全部的责任。因为项目的第一步是选择要不要做，对于一个有选择权的项目（不是上级压下来的），管理者需要全面的考虑项目的可行性、利润点、潜在风险。</p>
<p>在接手此项目之前，我并没有开发或者管理iPhone和Android项目的经验。因此，在项目过程中，我犯了很多错误，好在最终项目能够顺利结项，而我也从中学到了很多。</p>
<p><strong>面对问题、掌握难点</strong></p>
<p>首当其冲的是“回避问题”，外包软件开发者大多会依赖管理者对项目进度的追踪，往往自己被盯得紧一点，办事效率也会高一点。这次自己做管理者，最大的教训就是：如果管理者不主动尽早把潜在问题看透、说透，在开发后期，从预算、时间上，管理者都要付出几倍的代价。</p>
<p>管理者的另一方是客户，在与客户沟通的时候，不能够吝啬时间；特别是类似生意街手机应用这样的小项目，一定要尽可能的把需求的重点谈清楚，比如一个动画效果、社交网站分享、各个按钮的行为，要做到心中有数，否则这些模糊点，很可能就是后来令你发疯的问题点。</p>
<p><strong>沟通需求、强调后果</strong></p>
<p>本项目种，我在和客户谈好了价格、周期后，才开始从网上找开发者。这样做可能会耽误几天的时间，但其好处在于，可以把需求谈清楚。对于外包项目，开发成本（价格、时间）往往更容易受到需求变动的影响。需求变动的次数越多，开发成本就越昂贵。另外一点，管理者与外包开发者往往是通过IM和邮件沟通，管理者对开发者的能力并不是十分了解；比较保险的做法是尽可能的强调项目中的技术难点，以及无法完成的后果；通过外包平台的On Board记录这些内容，以便于在管理、沟通中掌握主动。</p>
<p><strong>了解能力、沟通时间</strong></p>
<p>尽可能的选择有较多项目经验的开发者。当然，这也要考虑到预算、运气的成分。保守的做法，是选择自己合作过的开发者，因为彼此都比较了解。这一次在选人上，错误的选择了一个在校大学生，虽然他的开发能力、做事态度都满足了我的要求，但项目的周期是在年末，学生因为考试无法抽出充分的时间在项目上，间接的对项目预算、周期造成了负面影响。</p>
<p><strong>分析依赖、确定预期</strong></p>
<p>对依赖关系的了解不够，在本项目中，手机端需要依赖网站的接口。在签订合同时，网站接口并没有实现，而是需要我方提供一个接口需求文档。由此，大致可以分析出客户公司的开发人员与市场人员的沟通并不流畅，管理者理应讲明此问题，并降低对接口部分开发效率、完成质量的预期。事实证明，接口方负责人严重的影响了本项目的开发进度，而我方变相的成为了接口的测试者，并因此耽误了很多时间。在签订合同时，管理者理应对此方面做出详细的说明：谁负责接口开发，谁负责功能性测试，谁负责稳定性测试，谁编写接口文档；因客户方的原因，导致开发进度受影响时，开发周期、项目预算是否可以调整；甚至，管理者可以考虑延期签订合同。</p>
<p><strong>一些细节、减少沟通代价</strong></p>
<p>对于开发者，可以要求提供紧急联系方式，方便在遇到严重问题时，及时联系。可以要求客户提供一个代码托管平台，或者要求其允许使用如Google Code的免费平台，在项目测试阶段，可以要求测试人员使用Issues功能，降低管理者在项目沟通上的权重。</p>
<p><strong>好的心态、第一步很重要</strong></p>
<p>项目的成败是由管理者主导的，所以管理者本人要具备一些积极的心态：掌握主导地位、主动面对困难、保持思维清晰、善于沟通和化解矛盾。在本项目签订合同时，我对项目时间的估计过于乐观，在价格谈判中也稍微软弱，这些导致后来在成本控制、时间管理上的困难。这些问题在生意街手机应用这样的小项目中，暴露的并不明显；不过我认为，如果项目规模较大，这些问题的负面影响将会明显的暴露出来；那时，在时间、价格上的妥协无异于自讨苦吃。</p>
<p>&#160;</p>
<p>最后贴上一段我认为还蛮不错的做人道理，是我父亲发给我的，以示自勉：</p>
<blockquote>
<p>人生三大遗憾：不会选择，不坚持选择，不断地选择；人生三不斗：不与君子斗名，不与小人斗利，不与天地斗巧；人生三大陷阱：大意，轻信，贪婪；人生三大悲哀：遇良师不学，遇良友不交，遇良机不握。人生三大不争：不与领导争锋，不与同事争宠，不与下级争功。</p>
</blockquote>

        
      </div>
    </div>

  

  
  
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2012/02/16/whats-happened-in-the-last-100-days/" >
  What’s happened in the last 100 days?
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2012/02/16/whats-happened-in-the-last-100-days/"><span class="article-date">
  2012-02-16
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Kevin-s-Life/">Kevin's Life</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Kevin-s-Life/Plan/">Plan</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Kevin-s-Life/Plan/Rework/">Rework</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Kevin-s-Life/Plan/Rework/Summary/">Summary</a></li></ul></li></ul></li></ul></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Business/">Business</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Present/">Present</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rework/">Rework</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iPhone/">iPhone</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p>当前状态：周四下午，临近下班，无所事事。肚子稍饿，头脑清醒，写作时间。打开豆瓣电台，第一首歌是张韶涵的《永晝》，第二首是张惠妹的《爱什么稀罕》，第三首是范玮琪的《我们的纪念日》，歌声在继续，时间在继续，生活在继续。</p>
<p>很难完整的回想从去年十一月开始的每一件事，只知这短短一转眼的瞬间，已经在世界末日的倒计时中了。二零一二，本命年，二十五岁，就这样来了。</p>
<p>首先整理一些琐碎的事情：维伟哥的小孩出生，十二月二十一，取名奚明远；李创表哥结婚，一月二日于舒城，缺席；冯威结婚，一月三日与海门，缺席；韵韵妹妹在上海找好了工作，凯捷技术支持，四月开始上班；陈清华的小孩出生，未知时间，收到三个费列罗；陆学慧结婚，未知时间。年会和老板坐一桌，敬酒一次；同事陈阳抽奖，IPHONE4S一部；柯达申请破产保护，相机业务被切掉。</p>
<p>人生总会有一个特殊的时刻，比如结婚，比如当爸爸。看似一瞬间，其实都是漫长的付出和努力。只是有些人，容易在小事上较真，而到了需要做重大决定的时候，却反而不够谨慎。感情、婚姻上的决定，不光是自己的事，如果糊涂的决定，伤害自己是活该，伤害了别人却是不该的。</p>
<p>因为朋友的关系认识了袁田（身份证号：34242519880831XXXX），第一次见面在浦东第一八佰伴吃俏江南，后来在上海科技馆牵手，世纪光棍节前夕，成功脱光。从光棍节到情人节，坎坎坷坷，不知不觉的在一起四个月了。在此省略一万字的夸奖、抱怨、评析、总结、预期。</p>
<p>在上一篇的文章中，我提到运气差，还有无故丢掉了两个大项目；其实事情在十一月有了转机，那个2000USD的项目招标人最终选择我来给他做事情，这个项目做得很顺利，我也有机会复习了套接字、线程互斥、Shell扩展等知识，一个月的时间，圆满的结束了。这也算是在新年来临前，一点点小小的奖励，也让我更加认同自己的价值。</p>
<p>另外一方面，张红梅同学给我介绍了她们公司的项目，预算在25,000CNY。这是一个手机开发项目，基于iPhone和Android平台，由于我在这两个平台上欠缺开发经验，加上时间上的限制（一个月开发完成），我意识到需要找两名开发者进行编码，而我则做沟通、管理。如此一来，我就必须把预算提高到16,000CNY，除去其他费用，其实我自己的利润已经非常有限了。这个项目的回报率很低，但是从另一方面说，让我熟悉了项目开发的整个流程，也让我学习到了很多外包项目管理上的经验。</p>
<p>春节回家，最开心的事情是见到妈妈、爸爸健健康康的，也感觉到他们都年过半百了，时间不饶人；最难受的事情是拜年，在家的几天，几乎天天有安排，比上班更累，压根没有假日休息。</p>
<p>春节前夕，得知柯达申请了破产保护，之后老板因为签证到期的缘故去了香港。上周五，得知柯达决定停止数码相机业务，作为一个相机项目组的员工，这当然不是一个好消息。至于现在，不知不觉一个星期已经过去，这一切还未尘埃落定；是去是留，我相信很快就会有答案了；好在我已经有了三年的工作经验，三四月找工作也是比较好的时间，天时地利人和。愿自己一切顺利，尘埃落定。这样，我才可以安排时间进行每年的旅行大计呀！</p>
<p>这些叫嚣着的周围，我想告诉你们，这生活本不是这样的，多走出去看看世界吧，虽然我们是这样的渺小、平庸，但这并不妨碍我们按照自己的方式活着；做自己，不要做别人的谁谁，不要做和谁一样的人。这样的路，一直都在脚下，需要的只是找准方向，而不是原地打转。</p>

        
      </div>
    </div>

  



  <div class="pagination">
    <a class="extend prev" rel="prev" href="/archives/2012/">Prev</a><a class="page-number" href="/archives/2012/">1</a><span class="page-number current">2</span>
  </div>




          <div class="main-footer">
  
    © 2016 Kevin&#39;s Blog - Powered by <a href="http://hexo.io" target="_blank">Hexo</a> - Theme <a href="https://github.com/denjones/hexo-theme-chan" target="_blank">Chan</a>
  
</div>

      
        </div>
      
    </div>
  </div>
  <script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

  <link rel="stylesheet" href="/PhotoSwipe/photoswipe.css">
  <link rel="stylesheet" href="/PhotoSwipe/default-skin/default-skin.css">

  <!-- Root element of PhotoSwipe. Must have class pswp. -->
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
             It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

      <!-- Container that holds slides.
                PhotoSwipe keeps only 3 of them in the DOM to save memory.
                Don't modify these 3 pswp__item elements, data is added later on. -->
      <div class="pswp__container">
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
      </div>

      <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
      <div class="pswp__ui pswp__ui--hidden">

        <div class="pswp__top-bar">

          <!--  Controls are self-explanatory. Order can be changed. -->

          <div class="pswp__counter"></div>

          <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

          <button class="pswp__button pswp__button--share" title="Share"></button>

          <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

          <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

          <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
          <!-- element will get class pswp__preloader--active when preloader is running -->
          <div class="pswp__preloader">
            <div class="pswp__preloader__icn">
              <div class="pswp__preloader__cut">
                <div class="pswp__preloader__donut"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
          <div class="pswp__share-tooltip"></div>
        </div>

        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>

        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

        <div class="pswp__caption">
          <div class="pswp__caption__center"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="/PhotoSwipe/photoswipe.js"></script>
  <script src="/PhotoSwipe/photoswipe-ui-default.js"></script>


<script src="/perfect-scrollbar/js/min/perfect-scrollbar.min.js"></script>
<script src="/scripts/main.js"></script>

</body>
</html>
