<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Hao Xi"><meta name="description" content="1.C++模板的介绍C++模板主要包括类（包括class和union）模板以及函数模板。编译器在编译期间会对模板进行特化，根据不同的模板实参为每个泛型类型实例化一个强类型。M个泛型类型，N个模板实参，编译后将产生MxN个强类型。C++模板的实例化是迟钝的，即只有在模板"><meta name="keywords" content="C#,Generic,Template"><title>Warm Up Series (5) – Template in Cpp and CSharp · Kevin's Blog</title><link rel="icon" href="/favicon.ico"><link rel="canonical" href="http://yoursite.com/2012/03/08/warm-up-series-5-template-in-cpp-and-csharp/"><link rel="alternate" href="/atom.xml" title="Kevin's Blog"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="/css/style.css"><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?Your baidu Analytics ID";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'Your Google Analytics ID', 'auto');
ga('send', 'pageview');</script></head><body><div id="main"><header><a href="/." class="logo">Kevin's Blog</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">Home</a></li><li class="nav-link"><a href="/archives/" target="_self">Archives</a></li><li class="nav-link"><a href="/categories/" target="_self">Categories</a></li><li class="nav-link"><a href="/tags/" target="_self">Tags</a></li><li class="nav-link"><a href="/about/" target="_self">About</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">Warm Up Series (5) – Template in Cpp and CSharp</h1><span class="post-time">Mar 8, 2012</span><div id="sidebar" class="post-sidebar"><h3 class="heading">Contents</h3><ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#"><span class="toc-text"></span></a></li></ol></div><div class="post-content"><p><strong><font size="2" face="Verdana">1. C++模板的介绍</font></strong></p>
<font size="2" face="Verdana">C++模板主要包括类（包括class和union）模板以及函数模板。编译器在编译期间会对模板进行特化，根据不同的模板实参为每个泛型类型实例化一个强类型。M个泛型类型，N个模板实参，编译后将产生M x N个强类型。</font>

<font size="2" face="Verdana">C++模板的实例化是迟钝的，即只有在模板被实例化并使用时，才会真正的创建相关的特化类、特化函数。C++泛型的优点是灵活、高性能、易扩展；缺点是容易导致代码膨胀，过分特化会出现很复杂的函数名，给调试造成了不便；另外，C++模板在不同物理实现之间不能共享实例化的强类型（如组件A和组件B不能共享std::vector&lt;int&gt;）。</font>

<p><strong><font size="2" face="Verdana">2. C++模板的使用</font></strong><br>  <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;line-height:12pt;background-color:#f4f4f4;width:97.5%;font-family:&#039;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;cursor:text;border-right:silver 1px solid;margin:20px 0 10px;padding:4px;" id="codeSnippetWrapper">   <div style="text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;" id="codeSnippet">     <pre style="text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;"><span style="color:#606060;" id="lnum1">   1:</span> <span style="color:#008000;">//template function.</span></pre><br><!--CRLF--></div></div></p>
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum2&quot;&gt;   2:&lt;/span&gt; &lt;span style=&quot;color:#0000ff;&quot;&gt;template&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#0000ff;&quot;&gt;class&lt;/span&gt; T&amp;gt;&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum3&quot;&gt;   3:&lt;/span&gt; &lt;span style=&quot;color:#0000ff;&quot;&gt;void&lt;/span&gt; swap(T &amp;amp;a, T &amp;amp;b)&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum4&quot;&gt;   4:&lt;/span&gt; {&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum5&quot;&gt;   5:&lt;/span&gt;     T temp = a;&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum6&quot;&gt;   6:&lt;/span&gt;     a = b;&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum7&quot;&gt;   7:&lt;/span&gt;     b = temp;&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum8&quot;&gt;   8:&lt;/span&gt; };&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum9&quot;&gt;   9:&lt;/span&gt;&amp;#160; &lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum10&quot;&gt;  10:&lt;/span&gt; &lt;span style=&quot;color:#008000;&quot;&gt;//template class&lt;/span&gt;&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum11&quot;&gt;  11:&lt;/span&gt; &lt;span style=&quot;color:#0000ff;&quot;&gt;template&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#0000ff;&quot;&gt;class&lt;/span&gt; T&amp;gt;&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum12&quot;&gt;  12:&lt;/span&gt; &lt;span style=&quot;color:#0000ff;&quot;&gt;class&lt;/span&gt; Arrary&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum13&quot;&gt;  13:&lt;/span&gt; {&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum14&quot;&gt;  14:&lt;/span&gt; &lt;span style=&quot;color:#0000ff;&quot;&gt;private&lt;/span&gt;:&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum15&quot;&gt;  15:&lt;/span&gt;     T* ar;&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum16&quot;&gt;  16:&lt;/span&gt;     &lt;span style=&quot;color:#0000ff;&quot;&gt;int&lt;/span&gt; l;&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum17&quot;&gt;  17:&lt;/span&gt;     ...&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum18&quot;&gt;  18:&lt;/span&gt; };&lt;/pre&gt;
</code></pre><!--CRLF--><br><br><br><font size="2" face="Verdana">实例化可以分为<strong>显示实例化</strong>、<strong>隐式实例化</strong>；显示的实例化通过指定某一特定类型，使编译器强制的生成该类型的实例化代码；隐式实例化则是编译器通过对代码调用的解析，根据模板的使用情况生成相应的实例化代码；隐式实例化类模板时，同时也实例化了模板的每个成员声明，但并没有实例化相应的定义，然而存在例外：如果类模板包含了一个<u>匿名的union</u>，那么该union定义的成员同时也被实例化了；作为实例化类模板的结果，<u>虚函数</u>的定义可能被实例化，也可能没有，这依赖于具体的实现。 </font><br><br><div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;line-height:12pt;background-color:#f4f4f4;width:97.5%;font-family:&#039;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;cursor:text;border-right:silver 1px solid;margin:20px 0 10px;padding:4px;" id="codeSnippetWrapper"><br>  <div style="text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;" id="codeSnippet"><br>    <pre style="text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;"><span style="color:#606060;" id="lnum1">   1:</span> <span style="color:#008000;">//explicit instantiation.</span></pre><br><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum2&quot;&gt;   2:&lt;/span&gt; &lt;span style=&quot;color:#0000ff;&quot;&gt;template&lt;/span&gt; &lt;span style=&quot;color:#0000ff;&quot;&gt;void&lt;/span&gt; swap&amp;lt;&lt;span style=&quot;color:#0000ff;&quot;&gt;int&lt;/span&gt;&amp;gt;(&lt;span style=&quot;color:#0000ff;&quot;&gt;int&lt;/span&gt; &amp;amp;a, &lt;span style=&quot;color:#0000ff;&quot;&gt;int&lt;/span&gt; &amp;amp;b); &lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum3&quot;&gt;   3:&lt;/span&gt; &lt;span style=&quot;color:#0000ff;&quot;&gt;template&lt;/span&gt; &lt;span style=&quot;color:#0000ff;&quot;&gt;class&lt;/span&gt; Array&amp;lt;&lt;span style=&quot;color:#0000ff;&quot;&gt;int&lt;/span&gt;&amp;gt;; &lt;/pre&gt;
</code></pre><!--CRLF--></div><br></div><br><br><font size="2" face="Verdana">那么也有一种情况，比如我们希望给job类型提供一份特殊的实例化代码，这就需要使用模板的<strong>显示具体化</strong>，使编译器下面的实现，而不是通过上面的模板实例化。</font><br><br><div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;line-height:12pt;background-color:#f4f4f4;width:97.5%;font-family:&#039;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;cursor:text;border-right:silver 1px solid;margin:20px 0 10px;padding:4px;" id="codeSnippetWrapper"><br>  <div style="text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;padding:0;" id="codeSnippet"><br>    <pre style="text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;"><span style="color:#606060;" id="lnum1">   1:</span> <span style="color:#008000;">//explicit specialization.</span></pre><br><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum2&quot;&gt;   2:&lt;/span&gt; &lt;span style=&quot;color:#0000ff;&quot;&gt;template&lt;/span&gt;&amp;lt;&amp;gt; &lt;span style=&quot;color:#0000ff;&quot;&gt;void&lt;/span&gt; swap&amp;lt;job&amp;gt;(job &amp;amp;a, job &amp;amp;b)&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum3&quot;&gt;   3:&lt;/span&gt; {&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum4&quot;&gt;   4:&lt;/span&gt;     &lt;span style=&quot;color:#0000ff;&quot;&gt;int&lt;/span&gt; salary = a.salary;&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum5&quot;&gt;   5:&lt;/span&gt;     a.salary = b.salary;&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum6&quot;&gt;   6:&lt;/span&gt;     b.salary = salary;&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum7&quot;&gt;   7:&lt;/span&gt; };&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum8&quot;&gt;   8:&lt;/span&gt; &lt;span style=&quot;color:#0000ff;&quot;&gt;template&lt;/span&gt;&amp;lt;&amp;gt; &lt;span style=&quot;color:#0000ff;&quot;&gt;class&lt;/span&gt; Array&amp;lt;job&amp;gt;&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum9&quot;&gt;   9:&lt;/span&gt; {&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum10&quot;&gt;  10:&lt;/span&gt;     ...&lt;/pre&gt;
</code></pre><!--CRLF-->
<pre><code>&lt;pre style=&quot;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&amp;#039;direction:ltr;color:black;font-size:8pt;overflow:visible;border-style:none;margin:0;padding:0;&quot;&gt;&lt;span style=&quot;color:#606060;&quot; id=&quot;lnum11&quot;&gt;  11:&lt;/span&gt; };&lt;/pre&gt;
</code></pre><p><!--CRLF--></p></div><br></div><p></p>
<font size="2"><font face="Verdana"><strong>3. C++模板实例化详解</strong> （请参考《</font></font><a href="http://blog.csdn.net/flowshell/article/details/6285711" target="_blank" rel="external"><font size="2" face="Verdana">C++模板实例化</font></a><font size="2" face="Verdana">》）</font>

<font size="2" face="Verdana">略。</font>

<font size="2" face="Verdana"><br><br><em> </em> *<br></font>

<p><strong><font size="2" face="Verdana">1. C#泛型的介绍</font></strong></p>
<font size="2" face="Verdana">C#的模板包括接口模板、类模板、成员函数模板。正确的说，C#的模板应该是指CLR的泛型，所以C++ CLR的模板实现和C#是一模一样的。在介绍C#泛型之前，让我们先看下Java的泛型实现；Java的泛型采用了代码共享技术，所有的实例化类型共享同一套强类型的代码。如List&lt;int&gt;和List&lt;string&gt;共享同一套强类型的代码List&lt;Object&gt;，这样实现有效的减少了代码生成量，但是因为涉及到</font><a href="http://www.cnblogs.com/huashanlin/archive/2007/05/16/749359.html" target="_blank" rel="external"><font size="2" face="Verdana">装箱、拆箱</font></a><font size="2" face="Verdana">，效率低且不够灵活。</font>

<font size="2" face="Verdana"></font>

<h5 id=""><a href="#" class="headerlink" title=""></a><font face="Verdana"></font></h5><font size="2" face="Verdana"></font>

<p><strong><font size="2" face="Verdana">2. C#泛型的实现</font></strong></p>
<font size="2" face="Verdana">C#的模板综合了C++和Java的泛型技术。采用了两阶段延迟特化的方式，从C#源码到IL的静态编译采用Java的代码共享思想，只生成一套抽象的IL代码，在CLR运行时JIT编译时，将IL的抽象代码即时编译，根据每个特化实参生成一个特化的强类型，如图：</font>

<font size="2" face="Verdana"><img src="http://www.99inf.net/SoftwareDev/UploadFiles_9259/200708/20078119191749.bmp" alt=""></font>

<font size="2" face="Verdana">C#的泛型兼备了C++模板和Java泛型的优点，代码简洁方便重用。值得一提的是，CLR对于引用类型，其泛型的工作方式略有不同。第一次使用任何引用类型构造泛型类型时，运行库会创建<strong>专用泛型类型</strong>，用对象引用替换IL中的参数。然后，每次使用引用类型实例化构造类型时，无论引用类型的具体类型是什么，运行库都会重用以前创建的泛型类型的专用版本。之所以可以这样，是因为所有引用的大小相同。</font>

<font size="2" face="Verdana">假设您有两个引用类型Customer和Order，并且您创建了Customer类型的一个泛型实例：Stack&lt;Customer&gt; customers；在此情况下，运行库生成Stack&lt;T&gt;类的一个专用版本，该版本不是存储数据，而是存储稍后将填写的对象引用。假设下一行代码创建另一个引用类型的堆栈泛型实例：Stack&lt;Order&gt; orders；不同于值类型，对于Order类型不创建Stack&lt;T&gt;类的另一个专用版本，而是创建Stack&lt;T&gt;类专用版本的一个实例，并将Order变量设置为引用它。因为引用类型的数量会随程序的不同而大幅变化，C#泛型将编译器为引用类型泛型类创建的专用类的数量减小到一个，大幅减少了代码量。</font>

<font size="2" face="Verdana"><br><br><em> </em> *<br></font>

<font size="2"><font face="Verdana"><strong>1.</strong> <strong>C++和C#泛型模型对比</strong></font></font>

<font size="2" face="Verdana">从整体上来说，因为C#为程序员提供了一致的编程方式，而且它在泛型编程的实现上借鉴了C++，所以相对C++，C#的泛型实现更简单、直接，但与此同时，C#在泛型实现并没有C++强大。下面是正对C++和C#在泛型实现方面的一个简单的对比：</font>

<p><strong><font size="2" face="Verdana"></font></strong></p>
<p><a href="http://kevinxi.files.wordpress.com/2012/03/image3.png" target="_blank" rel="external"><font size="2" face="Verdana"><img src="http://kevinxi.files.wordpress.com/2012/03/image_thumb3.png" alt="image" title="image"></font></a></p>
<font size="2" face="Verdana"><strong>2. 《</strong></font><a href="http://msdn.microsoft.com/zh-cn/library/c6cyy67b(v=vs.80" target="_blank" rel="external"><font size="2" face="Verdana"><strong>C++ 模板和 C# 泛型之间的区别</strong></font></a>.aspx)<font size="2" face="Verdana"><strong>》选自MSDN</strong></font>

<font size="2" face="Verdana">C#泛型和C++模板都是用于提供参数化类型支持的语言功能。然而，这两者之间存在许多差异。在语法层面上，C#泛型是实现参数化类型的更简单方法，不具有C++模板的复杂性。此外，C#并不尝试提供C++模板所提供的所有功能。在实现层面，主要区别在于，C#泛型类型替换是在运行时执行的，从而为实例化的对象保留了泛型类型信息。有关更多信息，请参见</font><a href="http://msdn.microsoft.com/zh-cn/library/f4a6ta2h(v=vs.80" target="_blank" rel="external"><font size="2" face="Verdana">运行库中的泛型（C# 编程指南）</font></a>.aspx)<br><br><font size="2">以下是C#泛型和C++模板之间的主要差异：</font>

<ul>
<li><font size="2" face="Verdana">C#泛型未提供与C++模板相同程度的灵活性。例如，尽管在C#泛型类中可以调用用户定义的运算符，但不能调用算术运算符。 </font></li>
<li><font size="2" face="Verdana">C#不允许非类型模板参数，如template C&lt;int i&gt;{}。 </font></li>
<li><font size="2" face="Verdana">C#不支持显式专用化，即特定类型的模板的自定义实现。 </font></li>
<li><font size="2" face="Verdana">C#不支持部分专用化：类型参数子集的自定义实现。 </font></li>
<li><font size="2" face="Verdana">C#不允许将类型参数用作泛型类型的基类。 </font></li>
<li><font size="2" face="Verdana">C#不允许类型参数具有默认类型。 </font></li>
<li><font size="2" face="Verdana">在C#中，尽管构造类型可用作泛型，但泛型类型参数自身不能是泛型。C++却是允许模板参数。 </font></li>
<li><font size="2" face="Verdana">C++允许那些可能并非对模板中的所有类型参数都有效的代码，然后将检查该代码中是否有用作类型参数的特定类型。C#要求相应地编写类中的代码，使之能够使用任何满足约束的类型。例如，可以在C++中编写对类型参数的对象使用算术运算符+和-的函数，这会在使用不支持这些运算符的类型来实例化模板时产生错误。C#不允许这样；唯一允许的语言构造是那些可从约束推导出来的构造。 </font>

</li>
</ul>
<font size="2" face="Verdana"></font></div></article><div class="tags"><a href="/tags/C/">C#</a><a href="/tags/Generic/">Generic</a><a href="/tags/Template/">Template</a></div><div class="paginator"><a href="/2012/03/09/warm-up-series-6-knowledge-of-heap-in-windows/" class="prev"><i class="iconfont icon-left"></i><span> Prev</span></a><a href="/2012/03/07/sum1n-problem/" class="next"><span>Next</span><i class="iconfont icon-right"></i></a></div><section id="comments"><div id="disqus_thread"></div></section><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://yoursite.com/2012/03/08/warm-up-series-5-template-in-cpp-and-csharp/';
    this.page.identifier = '2012/03/08/warm-up-series-5-template-in-cpp-and-csharp/';
    this.page.title = 'Warm Up Series (5) – Template in Cpp and CSharp';
};
(function() {
var d = document, s = d.createElement('script');

s.src = '//Your disqus ID.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();</script></section><footer><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2016<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">Hao Xi</span></p></div><label id="back2top"><i class="iconfont icon-up"></i></label></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></body></html>