<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Hao Xi"><meta name="description" content="A&amp;quot;callingconvention&amp;quot;isthewayinwhichafunctioniscalled.Thestandard__cdecliswhathasbeenusedupuntilnow,otherco"><meta name="keywords" content="C#"><title>Warm Up Series (8) – Calling Conventions · Kevin's Blog</title><link rel="icon" href="/favicon.ico"><link rel="canonical" href="http://yoursite.com/2012/03/28/warm-up-series-8-calling-conventions/"><link rel="alternate" href="/atom.xml" title="Kevin's Blog"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="/css/style.css"><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?Your baidu Analytics ID";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'Your Google Analytics ID', 'auto');
ga('send', 'pageview');</script></head><body><div id="main"><header><a href="/." class="logo">Kevin's Blog</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">Home</a></li><li class="nav-link"><a href="/archives/" target="_self">Archives</a></li><li class="nav-link"><a href="/categories/" target="_self">Categories</a></li><li class="nav-link"><a href="/tags/" target="_self">Tags</a></li><li class="nav-link"><a href="/about/" target="_self">About</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">Warm Up Series (8) – Calling Conventions</h1><span class="post-time">Mar 28, 2012</span><div id="sidebar" class="post-sidebar"><h3 class="heading">Contents</h3><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#cdecl-is-the-default-calling-convention-on-most-C-compilers-The-properties-are-as-follows"><span class="toc-text">__cdecl is the default calling convention on most C compilers. The properties are as follows:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fastcall-is-the-final-common-calling-convention-seen-All-implementations-of-fastcall-pass-parameters-in-registers-although-Microsoft-and-Borland-for-example-use-different-registers-Here-are-the-properties-of-Microsoft’s-fastcall-implementation"><span class="toc-text">__fastcall is the final common calling convention seen. All implementations of __fastcall pass parameters in registers, although Microsoft and Borland, for example, use different registers. Here are the properties of Microsoft’s __fastcall implementation:</span></a></li></ol></div><div class="post-content"><p>A &quot;calling convention&quot; is the way in which a function is called. The standard <font><font><font size="2"><em><font face="Courier New">__cdecl</font></em></font></font></font> is what has been used up until now, other common ones are <em><font size="2" face="Courier New">__stdcall</font></em>, <em><font size="2" face="Courier New">__fastcall</font></em>, and <em><font size="2" face="Courier New">__thiscall</font></em>, a less common convention used when writing hacks is <em><font size="2" face="Courier New">__declspec(naked)</font></em>.</p>
<h4 id="cdecl-is-the-default-calling-convention-on-most-C-compilers-The-properties-are-as-follows"><a href="#cdecl-is-the-default-calling-convention-on-most-C-compilers-The-properties-are-as-follows" class="headerlink" title="__cdecl is the default calling convention on most C compilers. The properties are as follows:"></a><font><font size="2"><em><font face="Courier New">__cdecl</font></em></font></font> is the default calling convention on most C compilers. The properties are as follows:</h4><ul>
<li>The caller places all the parameters on the stack*   The caller removes the parameters from the stack (often by adding the total size added to the stack pointer)  </li>
</ul>
<p><em><font size="2" face="Courier New">__stdcall</font></em> is another common calling convention. The properties are:</p>
<ul>
<li><p>The caller places all the parameters on the stack*   The called function removes the parameters from the stack, often by using the return instruction with a parameter equal to the number of parameters, &quot;ret xx&quot;  </p>
<p><pre><font size="4"></font></pre><br>The most useful part about <em><font size="2" face="Courier New">__stdcall</font></em> is that it tells a reverse engineer how many parameters are passed to any given function. In cases where no examples of the function being called may be found (possibly because it’s an exported DLL function), it is easier to check the return than to enumerate local variables.</p>
</li>
</ul>
<h4 id="fastcall-is-the-final-common-calling-convention-seen-All-implementations-of-fastcall-pass-parameters-in-registers-although-Microsoft-and-Borland-for-example-use-different-registers-Here-are-the-properties-of-Microsoft’s-fastcall-implementation"><a href="#fastcall-is-the-final-common-calling-convention-seen-All-implementations-of-fastcall-pass-parameters-in-registers-although-Microsoft-and-Borland-for-example-use-different-registers-Here-are-the-properties-of-Microsoft’s-fastcall-implementation" class="headerlink" title="__fastcall is the final common calling convention seen. All implementations of __fastcall pass parameters in registers, although Microsoft and Borland, for example, use different registers. Here are the properties of Microsoft’s __fastcall implementation:"></a><em><font size="2" face="Courier New">__fastcall</font></em> is the final common calling convention seen. All implementations of <em><font size="2" face="Courier New">__fastcall</font></em> pass parameters in registers, although Microsoft and Borland, for example, use different registers. Here are the properties of Microsoft’s <em><font size="2" face="Courier New">__fastcall</font></em> implementation:</h4><ul>
<li>First two parameters are passed in ecx and edx, respectively<em>   Third parameter and on are passed on the stack, as usual</em>   Functions clean up their own stack, if necessary</li>
</ul>
<p>Recognizing a <em><font size="2" face="Courier New">__fastcall</font></em> function is easy: look for ecx and edx being used without being initialized in a function.</p>
<p>A <em><font size="2" face="Courier New">__fastcall</font></em> with no parameters is identical to <font><font size="2"><em><font face="Courier New">__cdecl</font></em></font></font> and <em><font size="2" face="Courier New">__stdcall</font></em> with no parameters, and a <em><font size="2" face="Courier New">__fastcall</font></em> with a single parameter looks like <em><font size="2" face="Courier New">__thiscall</font></em>.</p>
<p>  <pre><font size="4"></font></pre><br>  <font size="2" face="Courier New"><font face="Verdana"></font><strong><em>thiscall</em></strong></font> is very similar to _<font size="2" face="Courier New">stdcall</font>_, except that a pointer to the class whose member is being called is passed in ecx.</p>
<ul>
<li><p>ecx is assigned a pointer to the class whose member is being called<em>   The parameters are placed on the stack, the same as <em><font size="2" face="Courier New">__stdcall</font></em></em>   The function cleans itself up, the same as <em><font size="2" face="Courier New">__stdcall</font></em></p>
<p><pre><font size="4"></font></pre><br><em><font size="2" face="Courier New">__declspec(naked)</font></em> is a Visual Studio-specific convention, can’t really be identified in assembly, since it’s identical to <font><font size="2"><em><font face="Courier New">__cdecl</font></em></font></font> once it reaches assembly. However, the special property of this convention is that the compiler will generate no code in a function. This allows the program, in a __asm{} block, to write everything from preserving registers to allocating local variables and returning. This is useful when patching a jump in the middle of code, since it prevents the function from changing registers without the programmer’s knowledge.</p>
</li>
</ul>
</div></article><div class="tags"><a href="/tags/C/">C#</a></div><div class="paginator"><a href="/2012/03/28/warm-up-series-7-keywords-used-in-c/" class="next"><span>Next</span><i class="iconfont icon-right"></i></a></div><section id="comments"><div id="disqus_thread"></div></section><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://yoursite.com/2012/03/28/warm-up-series-8-calling-conventions/';
    this.page.identifier = '2012/03/28/warm-up-series-8-calling-conventions/';
    this.page.title = 'Warm Up Series (8) – Calling Conventions';
};
(function() {
var d = document, s = d.createElement('script');

s.src = '//Your disqus ID.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();</script></section><footer><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2016<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">Hao Xi</span></p></div><label id="back2top"><i class="iconfont icon-up"></i></label></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></body></html>